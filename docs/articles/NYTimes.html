<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NY Time Blog Analysis • NYTimes</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">NYTimes</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/NYTimes.html">Analysis</a>
</li>
<li>
  <a href="../reference/index.html">Data</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kuhnrl30/NYTimes">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>NY Time Blog Analysis</h1>
                        <h4 class="author">Ryan Kuhn</h4>
            
            <h4 class="date">July 7, 2016</h4>
          </div>

    
    
<div class="contents">
<div id="setup-the-environment-and-load-the-data" class="section level4">
<h4 class="hasAnchor">
<a href="#setup-the-environment-and-load-the-data" class="anchor"></a>Setup the environment and load the data</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tm)
<span class="kw">library</span>(rpart)
<span class="kw">library</span>(rpart.plot)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(caTools)
<span class="kw">library</span>(ROCR)
<span class="kw">library</span>(caret)
<span class="kw">library</span>(randomForest)
<span class="kw">library</span>(gbm)
<span class="kw">library</span>(NYTimes)

<span class="kw">data</span>(trainingset)
<span class="kw">data</span>(testingset)

train&lt;-<span class="st"> </span>trainingset
test &lt;-<span class="st"> </span>testingset</code></pre></div>
</div>
<div id="data-cleaning" class="section level3">
<h3 class="hasAnchor">
<a href="#data-cleaning" class="anchor"></a>Data Cleaning</h3>
<div id="setting-factors" class="section level4">
<h4 class="hasAnchor">
<a href="#setting-factors" class="anchor"></a>Setting factors</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lvls&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Business"</span>,<span class="st">""</span>,<span class="st">"Culture"</span>,<span class="st">"Foreign"</span>, <span class="st">"Magazine"</span>,<span class="st">"Metro"</span>,<span class="st">"OpEd"</span>, <span class="st">"Science"</span>,<span class="st">"Sports"</span>,<span class="st">"Styles"</span>, <span class="st">"Travel"</span>,<span class="st">"TStyle"</span>,<span class="st">"National"</span>)

train$NewsDesk&lt;-<span class="st"> </span><span class="kw">factor</span>(train$NewsDesk, <span class="dt">levels=</span>lvls)
test$NewsDesk &lt;-<span class="st"> </span><span class="kw">factor</span>(test$NewsDesk, <span class="dt">levels=</span>lvls)


train$SectionName   &lt;-<span class="st"> </span><span class="kw">relevel</span>(<span class="kw">as.factor</span>(train$SectionName),<span class="st">"Business Day"</span>)
train$SubsectionName&lt;-<span class="st"> </span><span class="kw">relevel</span>(<span class="kw">as.factor</span>(train$SubsectionName), <span class="st">"Dealbook"</span>)

test$SectionName   &lt;-<span class="st"> </span><span class="kw">factor</span>(test$SectionName, <span class="dt">levels=</span><span class="kw">levels</span>(train$SectionName))
test$SubsectionName&lt;-<span class="st"> </span><span class="kw">factor</span>(test$SubsectionName, <span class="dt">levels=</span><span class="kw">levels</span>(train$SubsectionName))


train$PubDate&lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(train$PubDate,<span class="dt">format=</span> <span class="st">"%Y-%m-%e"</span>)
train$wkday  &lt;-<span class="st"> </span><span class="kw">relevel</span>(<span class="kw">as.factor</span>(<span class="kw">weekdays</span>(train$PubDate)),<span class="st">"Friday"</span>)

test$PubDate&lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(test$PubDate,<span class="dt">format=</span><span class="st">"%Y-%m-%e"</span>)
test$wkday  &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">weekdays</span>(test$PubDate), <span class="dt">levels=</span><span class="kw">levels</span>(train$wkday))</code></pre></div>
</div>
<div id="formatting-headlines" class="section level4">
<h4 class="hasAnchor">
<a href="#formatting-headlines" class="anchor"></a>Formatting headlines</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Questions &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">"?"</span>, train$Headline, <span class="dt">fixed=</span>T)
QnA       &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">"Q. and A."</span>, train$Headline, <span class="dt">fixed=</span>T)
Gift      &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">"The Daily Gift"</span>, train$Headline, <span class="dt">fixed=</span>T)
Clip      &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">"Daily Clip Report"</span>, train$Headline, <span class="dt">fixed=</span>T)
Recap     &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">"Recap"</span>,train$Headline, <span class="dt">fixed=</span>T)

train$type            &lt;-<span class="st">"None"</span>
train$type[QnA]       &lt;-<span class="st">"QnA"</span>
train$type[Questions] &lt;-<span class="st">"Question"</span>
train$type[Gift]      &lt;-<span class="st">"Gift"</span>
train$type[Clip]      &lt;-<span class="st">"Clip"</span>
train$type[Recap]     &lt;-<span class="st">"Recap"</span>
train$type&lt;-<span class="st"> </span><span class="kw">factor</span>(train$type, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">"None"</span>,<span class="st">"Question"</span>,<span class="st">"Gift"</span>,<span class="st">"Clip"</span>,<span class="st">"QnA"</span>,<span class="st">"Recap"</span>))



Questions &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">"?"</span>, test$Headline, <span class="dt">fixed=</span>T)
QnA       &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">"Q. and A."</span>, test$Headline, <span class="dt">fixed=</span>T)
Gift      &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">"The Daily Gift"</span>, test$Headline, <span class="dt">fixed=</span>T)
Clip      &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">"Daily Clip Report"</span>, test$Headline, <span class="dt">fixed=</span>T)
Recap     &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">"Recap"</span>,test$Headline, <span class="dt">fixed=</span>T)

test$type            &lt;-<span class="st">"None"</span>
test$type[QnA]       &lt;-<span class="st">"QnA"</span>
test$type[Questions] &lt;-<span class="st">"Question"</span>
test$type[Gift]      &lt;-<span class="st">"Gift"</span>
test$type[Clip]      &lt;-<span class="st">"Clip"</span>
test$type[Recap]     &lt;-<span class="st">"Recap"</span>
test$type&lt;-<span class="st"> </span><span class="kw">factor</span>(test$type, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">"None"</span>,<span class="st">"Question"</span>,<span class="st">"Gift"</span>,<span class="st">"Clip"</span>,<span class="st">"QnA"</span>,<span class="st">"Recap"</span>))</code></pre></div>
</div>
</div>
<div id="modeling" class="section level3">
<h3 class="hasAnchor">
<a href="#modeling" class="anchor"></a>Modeling</h3>
<div id="split-the-training-dataset" class="section level4">
<h4 class="hasAnchor">
<a href="#split-the-training-dataset" class="anchor"></a>Split the training dataset</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">split&lt;-<span class="st"> </span><span class="kw">sample.split</span>(train$Popular, <span class="dt">SplitRatio=</span>.<span class="dv">7</span>)

Ttrain&lt;-<span class="st"> </span><span class="kw">subset</span>(train, split==<span class="ot">TRUE</span>)
Ttest &lt;-<span class="st"> </span><span class="kw">subset</span>(train, split==<span class="ot">FALSE</span>)
<span class="kw">rm</span>(split)</code></pre></div>
</div>
<div id="baseline-model" class="section level4">
<h4 class="hasAnchor">
<a href="#baseline-model" class="anchor"></a>Baseline model</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Ttrain %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(Popular) %&gt;%
<span class="st">  </span><span class="kw">select</span>(Popular) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">N=</span><span class="kw">n</span>())

Base&lt;-<span class="dv">3807</span>/<span class="kw">nrow</span>(Ttrain)
BasePred&lt;-<span class="kw">rep</span>(Base,<span class="kw">nrow</span>(Ttest))

ROCRpred&lt;-<span class="kw">prediction</span>(BasePred,Ttest$Popular)
ROCRperf&lt;-<span class="st"> </span><span class="kw">performance</span>(ROCRpred,<span class="st">"tpr"</span>,<span class="st">"fpr"</span>)
<span class="kw">plot</span>(ROCRperf)</code></pre></div>
<p><img src="NYTimes_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<pre><code>## # A tibble: 2 × 2
##   Popular     N
##     &lt;int&gt; &lt;int&gt;
## 1       0  3807
## 2       1   765</code></pre>
<p>Baseline percentage is 83% Base AUC score is is 0.5</p>
</div>
<div id="logistic-regression" class="section level4">
<h4 class="hasAnchor">
<a href="#logistic-regression" class="anchor"></a>Logistic Regression</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">LogMdl&lt;-<span class="st"> </span><span class="kw">glm</span>(Popular~.,<span class="dt">data=</span>Ttrain[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>)], <span class="dt">family=</span>binomial)
PredLog&lt;-<span class="kw">predict</span>(LogMdl,<span class="dt">newdata=</span>Ttest[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>)],<span class="dt">type=</span><span class="st">"response"</span>)


ROCRpred&lt;-<span class="kw">prediction</span>(PredLog,Ttest$Popular)
ROCRperf&lt;-<span class="st"> </span><span class="kw">performance</span>(ROCRpred,<span class="st">"tpr"</span>,<span class="st">"fpr"</span>)
<span class="kw">plot</span>(ROCRperf)</code></pre></div>
<p><img src="NYTimes_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>AUC score is 0.901</p>
</div>
<div id="clustering" class="section level4">
<h4 class="hasAnchor">
<a href="#clustering" class="anchor"></a>Clustering</h4>
<p><em>Except…</em> clustering is doesn’t work for predictions. You’d have to do seperate models for each cluster.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Tcluster&lt;-Ttrain[,<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">3</span>,<span class="dv">9</span>,<span class="dv">11</span>)]
Tcluster$time&lt;-<span class="kw">scale</span>(Ttrain$WordCount)

Tdummies&lt;-<span class="kw">dummyVars</span>(Popular~.,<span class="dt">data=</span>Tcluster)
Tdumb&lt;-<span class="kw">predict</span>(Tdummies,<span class="dt">newdata=</span>Tcluster)

Dist&lt;-<span class="kw">dist</span>(Tdumb,<span class="dt">method=</span><span class="st">"euclidean"</span>)
clusters&lt;-<span class="kw">hclust</span>(Dist,<span class="dt">method=</span><span class="st">"ward.D"</span>)
<span class="kw">plot</span>(clusters, <span class="dt">axes=</span>F, <span class="dt">labels=</span>F)</code></pre></div>
<p><img src="NYTimes_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clusterGroups&lt;-<span class="kw">cutree</span>(clusters,<span class="dt">k=</span><span class="dv">3</span>)
clusterGroups&lt;-<span class="kw">data.frame</span>(<span class="dt">clusters=</span><span class="kw">matrix</span>(clusterGroups,<span class="dt">ncol=</span><span class="dv">1</span>))


clustdummies&lt;-<span class="kw">dummyVars</span>(clusters~.,<span class="dt">data=</span>clusterGroups)
clusterGroupsdumb&lt;-<span class="kw">as.data.frame</span>(<span class="kw">predict</span>(clustdummies,<span class="dt">newdata=</span>clusterGroups))</code></pre></div>
</div>
</div>
<div id="text-analytics" class="section level3">
<h3 class="hasAnchor">
<a href="#text-analytics" class="anchor"></a>Text Analytics</h3>
<div id="prepare-the-training-set" class="section level4">
<h4 class="hasAnchor">
<a href="#prepare-the-training-set" class="anchor"></a>Prepare the training set</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">TrainCorpus&lt;-<span class="kw">Corpus</span>(<span class="kw">VectorSource</span>(Ttrain$Abstract))
TrainCorpus&lt;-<span class="kw">tm_map</span>(TrainCorpus,<span class="kw">content_transformer</span>(tolower))
TrainCorpus&lt;-<span class="kw">tm_map</span>(TrainCorpus, PlainTextDocument)
TrainCorpus&lt;-<span class="kw">tm_map</span>(TrainCorpus,removePunctuation)
TrainCorpus&lt;-<span class="kw">tm_map</span>(TrainCorpus,stemDocument)
TrainCorpus&lt;-<span class="kw">tm_map</span>(TrainCorpus,removeWords, 
                    <span class="kw">c</span>(<span class="st">"2015"</span>,<span class="st">"about"</span>,
                      <span class="kw">stopwords</span>(<span class="st">"english"</span>)))

dtmTrain&lt;-<span class="st"> </span><span class="kw">DocumentTermMatrix</span>(TrainCorpus)

sparseTrain&lt;-<span class="kw">removeSparseTerms</span>(dtmTrain,<span class="fl">0.98</span>)

wordsTrain&lt;-<span class="kw">as.data.frame</span>(<span class="kw">inspect</span>(sparseTrain))
Targets&lt;-<span class="kw">colnames</span>(wordsTrain)
<span class="kw">colnames</span>(wordsTrain) =<span class="st"> </span><span class="kw">paste</span>(<span class="st">"A"</span>, <span class="kw">colnames</span>(wordsTrain),<span class="dt">sep=</span><span class="st">""</span>)

TextTrain&lt;-<span class="kw">data.frame</span>(wordsTrain,Ttrain$Popular, <span class="dt">row.names=</span><span class="ot">NULL</span>)</code></pre></div>
</div>
<div id="prepare-test-set" class="section level4">
<h4 class="hasAnchor">
<a href="#prepare-test-set" class="anchor"></a>Prepare test set</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">TestCorpus&lt;-<span class="kw">Corpus</span>(<span class="kw">VectorSource</span>(Ttest$Abstract))
TestCorpus&lt;-<span class="kw">tm_map</span>(TestCorpus,<span class="kw">content_transformer</span>(tolower))
TestCorpus&lt;-<span class="kw">tm_map</span>(TestCorpus, PlainTextDocument)
TestCorpus&lt;-<span class="kw">tm_map</span>(TestCorpus,removePunctuation)
TestCorpus&lt;-<span class="kw">tm_map</span>(TestCorpus,removeWords,<span class="kw">stopwords</span>(<span class="st">"english"</span>))
TestCorpus&lt;-<span class="kw">tm_map</span>(TestCorpus,stemDocument)
dtmTest&lt;-<span class="st"> </span><span class="kw">DocumentTermMatrix</span>(TestCorpus)

wordsTest&lt;-<span class="kw">inspect</span>(dtmTest[,<span class="kw">colnames</span>(dtmTest) %in%<span class="st"> </span>Targets])
<span class="kw">colnames</span>(wordsTest) =<span class="st"> </span><span class="kw">paste</span>(<span class="st">"A"</span>, <span class="kw">colnames</span>(wordsTest),<span class="dt">sep=</span><span class="st">""</span>)
TextTest&lt;-<span class="kw">data.frame</span>(wordsTest,Ttest$Popular,<span class="dt">row.names=</span><span class="ot">NULL</span>)</code></pre></div>
</div>
<div id="prepare-the-model" class="section level4">
<h4 class="hasAnchor">
<a href="#prepare-the-model" class="anchor"></a>Prepare the model</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">TextLogMdl&lt;-<span class="kw">glm</span>(Ttrain.Popular~.,<span class="dt">data=</span>TextTrain,<span class="dt">family=</span>binomial)

TextLogPred&lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">predict</span>(TextLogMdl,<span class="dt">newdata=</span>TextTest,<span class="dt">type=</span><span class="st">"response"</span>))

<span class="kw">table</span>(Ttest$Popular,TextLogPred&gt;.<span class="dv">5</span>)
<span class="kw">table</span>(train$Popular)

ROCRpred&lt;-<span class="st"> </span><span class="kw">prediction</span>(TextLogPred,Ttest$Popular)
ROCRperf&lt;-<span class="st"> </span><span class="kw">performance</span>(ROCRpred,<span class="st">"tpr"</span>,<span class="st">"fpr"</span>)
<span class="kw">plot</span>(ROCRperf)</code></pre></div>
<p><img src="NYTimes_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>AUC score is 0.706</p>
</div>
<div id="train-cart" class="section level4">
<h4 class="hasAnchor">
<a href="#train-cart" class="anchor"></a>Train CART</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">CART&lt;-<span class="st"> </span><span class="kw">rpart</span>(Popular~.,<span class="dt">data=</span>Ttrain[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>)], 
             <span class="dt">method=</span><span class="st">"class"</span>,           
             <span class="dt">na.action=</span>na.rpart,
             <span class="dt">control=</span><span class="kw">rpart.control</span>(<span class="dt">xval=</span><span class="dv">10</span>,<span class="dt">cp=</span><span class="fl">0.05</span>,<span class="dt">minbucket=</span><span class="dv">10</span>))

CART&lt;-<span class="kw">prune</span>(CART,<span class="dt">cp=</span><span class="fl">0.05</span>)

<span class="kw">prp</span>(CART, 
    <span class="dt">main=</span> <span class="st">"RAOP Classification Tree"</span>,
    <span class="dt">extra=</span><span class="dv">1</span>,
    <span class="dt">box.col=</span><span class="kw">c</span>(<span class="st">"pink"</span>,<span class="st">"palegreen"</span>)[CART$frame$yval],
    <span class="dt">leaf.round=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="NYTimes_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">CARTPred&lt;-<span class="st"> </span><span class="kw">predict</span>(CART,<span class="dt">newdata=</span>Ttest[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>)], <span class="dt">type=</span><span class="st">"prob"</span>)

ROCRpred&lt;-<span class="st"> </span><span class="kw">prediction</span>(CARTPred[,<span class="dv">2</span>],Ttest$Popular)
ROCRperf&lt;-<span class="st"> </span><span class="kw">performance</span>(ROCRpred,<span class="st">"tpr"</span>,<span class="st">"fpr"</span>)
<span class="kw">plot</span>(ROCRperf)</code></pre></div>
<p><img src="NYTimes_files/figure-html/unnamed-chunk-12-2.png" width="672"></p>
<p>AUC score is 0.734 and is not an improvement over the GLM model.</p>
</div>
<div id="train-random-forest" class="section level4">
<h4 class="hasAnchor">
<a href="#train-random-forest" class="anchor"></a>Train Random Forest</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Forest&lt;-<span class="st"> </span><span class="kw">randomForest</span>(<span class="kw">as.factor</span>(Popular)~.,
                      <span class="dt">data=</span>Ttrain[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>)],
                      <span class="dt">nodesize=</span><span class="dv">5</span>)

ForestPred&lt;-<span class="kw">predict</span>(Forest,
                    <span class="dt">newdata=</span>Ttest[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>)], 
                    <span class="dt">type=</span><span class="st">"prob"</span>,
                    <span class="dt">metric=</span><span class="st">"ROC"</span>)

ROCRpred&lt;-<span class="st"> </span><span class="kw">prediction</span>(ForestPred[,<span class="dv">2</span>],Ttest$Popular)
ROCRperf&lt;-<span class="st"> </span><span class="kw">performance</span>(ROCRpred,<span class="st">"tpr"</span>,<span class="st">"fpr"</span>)
<span class="kw">plot</span>(ROCRperf)</code></pre></div>
<p><img src="NYTimes_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ForestPred2&lt;-<span class="kw">predict</span>(Forest,<span class="dt">newdata=</span>test[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">10</span>,<span class="dv">11</span>)], <span class="dt">type=</span><span class="st">"prob"</span>,<span class="dt">metric=</span><span class="st">"ROC"</span>)</code></pre></div>
<p>AUC score is 0.891 and is not an improvement over the GLM model.</p>
</div>
<div id="random-forest-using-text-analytics" class="section level4">
<h4 class="hasAnchor">
<a href="#random-forest-using-text-analytics" class="anchor"></a>Random Forest Using Text Analytics</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">TtrainComb&lt;-<span class="st"> </span><span class="kw">data.frame</span>(TextTrain, Ttrain[,<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">3</span>, <span class="dv">7</span>:<span class="dv">8</span>,<span class="dv">11</span>:<span class="dv">12</span>)])

ForestComb&lt;-<span class="st"> </span><span class="kw">randomForest</span>(<span class="kw">as.factor</span>(Ttrain.Popular)~.,
                          <span class="dt">data=</span>TtrainComb,
                          <span class="dt">nodesize=</span><span class="dv">5</span>)

TtestComb&lt;-<span class="st"> </span><span class="kw">data.frame</span>(TextTest, Ttest[,<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">3</span>,<span class="dv">7</span>:<span class="dv">9</span>,<span class="dv">11</span>:<span class="dv">12</span>)])

ForestPredComb&lt;-<span class="kw">predict</span>(ForestComb,
                        <span class="dt">newdata=</span>TtestComb,
                        <span class="dt">type=</span><span class="st">"prob"</span>,
                        <span class="dt">metric=</span><span class="st">"ROC"</span>)

ROCRpred&lt;-<span class="st"> </span><span class="kw">prediction</span>(ForestPredComb[,<span class="dv">2</span>],Ttest$Popular)
ROCRperf&lt;-<span class="st"> </span><span class="kw">performance</span>(ROCRpred,<span class="st">"tpr"</span>,<span class="st">"fpr"</span>)
<span class="kw">plot</span>(ROCRperf)</code></pre></div>
<p><img src="NYTimes_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<p>AUC score is 0.942- best model yet!</p>
</div>
<div id="train-ensembling" class="section level4">
<h4 class="hasAnchor">
<a href="#train-ensembling" class="anchor"></a>Train ensembling</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">AUCs&lt;-<span class="kw">c</span>(.<span class="dv">8756</span>,.<span class="dv">7048</span>,.<span class="dv">7249</span>,.<span class="dv">8811</span>,.<span class="dv">9453</span>)
Predictions&lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">GLM=</span>PredLog,
                         <span class="dt">Text=</span>TextLogPred, 
                         <span class="dt">CART=</span>CARTPred[,<span class="dv">2</span>],
                         <span class="dt">Forest=</span>ForestPred[,<span class="dv">2</span>],
                         <span class="dt">Comb=</span>ForestPredComb[,<span class="dv">2</span>])
weights&lt;-<span class="kw">c</span>(.<span class="dv">20</span>,.<span class="dv">20</span>,.<span class="dv">20</span>,.<span class="dv">20</span>,.<span class="dv">20</span>)
weightedPred&lt;-Predictions*weights
Temp&lt;-<span class="st"> </span><span class="kw">rowSums</span>(weightedPred,<span class="dt">na.rm=</span>T)

ROCRpred&lt;-<span class="st"> </span><span class="kw">prediction</span>(Temp,Ttest$Popular)
ROCRperf&lt;-<span class="st"> </span><span class="kw">performance</span>(ROCRpred,<span class="st">"tpr"</span>,<span class="st">"fpr"</span>)
<span class="kw">plot</span>(ROCRperf)</code></pre></div>
<p><img src="NYTimes_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<p>AUC score is 0.924</p>
</div>
<div id="test-nlp" class="section level4">
<h4 class="hasAnchor">
<a href="#test-nlp" class="anchor"></a>Test NLP</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">TestCorpus2&lt;-<span class="kw">Corpus</span>(<span class="kw">VectorSource</span>(test$Abstract))
TestCorpus2&lt;-<span class="kw">tm_map</span>(TestCorpus2, <span class="kw">content_transformer</span>(tolower))
TestCorpus2&lt;-<span class="kw">tm_map</span>(TestCorpus2, PlainTextDocument)
TestCorpus2&lt;-<span class="kw">tm_map</span>(TestCorpus2, removePunctuation)
TestCorpus2&lt;-<span class="kw">tm_map</span>(TestCorpus2, removeWords,<span class="kw">stopwords</span>(<span class="st">"english"</span>))
TestCorpus2&lt;-<span class="kw">tm_map</span>(TestCorpus2, stemDocument)
dtmTest2&lt;-<span class="st"> </span><span class="kw">DocumentTermMatrix</span>(TestCorpus2)

wordsTest2&lt;-<span class="kw">inspect</span>(dtmTest2[,<span class="kw">colnames</span>(dtmTest2) %in%<span class="st"> </span>Targets])
<span class="kw">colnames</span>(wordsTest2) =<span class="st"> </span><span class="kw">paste</span>(<span class="st">"A"</span>, <span class="kw">colnames</span>(wordsTest2),<span class="dt">sep=</span><span class="st">""</span>)
TextTest2&lt;-<span class="kw">data.frame</span>(wordsTest2,<span class="dt">row.names=</span><span class="ot">NULL</span>)</code></pre></div>
</div>
<div id="test-random-forest-2" class="section level4">
<h4 class="hasAnchor">
<a href="#test-random-forest-2" class="anchor"></a>Test Random Forest 2</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">TtestComb2&lt;-<span class="st"> </span><span class="kw">data.frame</span>(TextTest2, test[,<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">3</span>,<span class="dv">7</span>:<span class="dv">8</span>,<span class="dv">10</span>:<span class="dv">11</span>)])


<span class="co"># Test Predictions ----</span>

PredLog2        &lt;-<span class="st"> </span><span class="kw">predict</span>(LogMdl,
                           <span class="dt">newdata=</span>test[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">10</span>,<span class="dv">11</span>)],
                           <span class="dt">type=</span><span class="st">"response"</span>)
TextLogPred2    &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">predict</span>(TextLogMdl,<span class="dt">newdata=</span>TextTest2,<span class="dt">type=</span><span class="st">"response"</span>))
CARTPred2       &lt;-<span class="st"> </span><span class="kw">predict</span>(CART,  
                           <span class="dt">newdata=</span>test[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">10</span>,<span class="dv">11</span>)], 
                           <span class="dt">type=</span><span class="st">"prob"</span>)
ForestPred2     &lt;-<span class="st"> </span><span class="kw">predict</span>(Forest,
                           <span class="dt">newdata=</span>test[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">10</span>,<span class="dv">11</span>)], 
                           <span class="dt">type=</span><span class="st">"prob"</span>,
                           <span class="dt">metric=</span><span class="st">"ROC"</span>)
ForestPredComb2 &lt;-<span class="st"> </span><span class="kw">predict</span>(ForestComb,
                           <span class="dt">newdata=</span>TtestComb2,
                           <span class="dt">type=</span><span class="st">"prob"</span>,
                           <span class="dt">metric=</span><span class="st">"ROC"</span>)</code></pre></div>
</div>
<div id="weight-the-models" class="section level4">
<h4 class="hasAnchor">
<a href="#weight-the-models" class="anchor"></a>Weight the Models</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Predictions2&lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">GLM=</span>PredLog2,
                          <span class="dt">Text=</span>TextLogPred2, 
                          <span class="dt">CART=</span>CARTPred2[,<span class="dv">2</span>], 
                          <span class="dt">Forest=</span>ForestPred2[,<span class="dv">2</span>],
                          <span class="dt">Comb=</span>ForestPredComb2[,<span class="dv">2</span>])
weightedPred2&lt;-Predictions2*weights
Temp2&lt;-<span class="st"> </span><span class="kw">rowSums</span>(weightedPred2,<span class="dt">na.rm=</span>T)


Submit2&lt;-<span class="kw">data.frame</span>(<span class="dt">UniqueID=</span>test$UniqueID,<span class="dt">Probability1=</span>Temp2)

<span class="co"># Just RandomForestComn</span>
Submit2&lt;-<span class="kw">data.frame</span>(<span class="dt">UniqueID=</span>test$UniqueID,<span class="dt">Probability1=</span>ForestPredComb2[,<span class="dv">2</span>])</code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Ryan Kuhn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
